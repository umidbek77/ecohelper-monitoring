<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECOHELPER | Statistika va Monitoring</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #1e293b;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --info-color: #06b6d4;
      --background-color: #f1f5f9;
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      --sidebar-width: 300px;
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --gradient-warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--gradient-primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .main-container {
      background: var(--background-color);
      border-radius: 25px;
      margin: 15px;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      min-height: calc(100vh - 30px);
      position: relative;
    }

    .sidebar {
      background: linear-gradient(180deg, var(--secondary-color) 0%, #334155 100%);
      color: white;
      width: var(--sidebar-width);
      min-height: 100%;
      padding: 0;
      position: fixed;
      left: 15px;
      top: 15px;
      border-radius: 25px 0 0 25px;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .sidebar-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .sidebar-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-info);
      opacity: 0.1;
      z-index: -1;
    }

    .sidebar-header h4 {
      margin: 0;
      font-weight: 700;
      font-size: 1.4rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .sidebar-header small {
      opacity: 0.8;
      font-size: 0.9rem;
    }

    .sidebar-nav {
      padding: 25px 0;
    }

    .nav-item {
      margin: 8px 20px;
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }

    .nav-item:hover::before {
      left: 100%;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(8px) scale(1.02);
    }

    .nav-link {
      color: rgba(255, 255, 255, 0.85);
      text-decoration: none;
      padding: 18px 25px;
      display: flex;
      align-items: center;
      font-weight: 500;
      transition: all 0.3s ease;
      border-radius: 15px;
    }

    .nav-link:hover {
      color: white;
      background: rgba(255, 255, 255, 0.05);
    }

    .nav-link.active {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 8px 25px -8px rgba(37, 99, 235, 0.5);
    }

    .nav-link i {
      margin-right: 15px;
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }

    .content {
      margin-left: var(--sidebar-width);
      padding: 25px;
      background: var(--background-color);
      min-height: 100vh;
    }

    .section {
      display: none;
      animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .section.active {
      display: block;
    }

    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px) scale(0.95); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    .page-header {
      background: white;
      padding: 30px 35px;
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      margin-bottom: 35px;
      border-left: 6px solid var(--primary-color);
      position: relative;
      overflow: hidden;
    }

    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100%;
      background: var(--gradient-primary);
      opacity: 0.05;
      transform: skewX(-15deg);
    }

    .page-header h2 {
      margin: 0;
      color: var(--secondary-color);
      font-weight: 700;
      display: flex;
      align-items: center;
      font-size: 1.8rem;
    }

    .page-header h2 i {
      margin-right: 20px;
      color: var(--primary-color);
      font-size: 2rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 35px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .stat-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }

    .stat-card.primary::before { background: var(--gradient-primary); }
    .stat-card.success::before { background: var(--gradient-success); }
    .stat-card.warning::before { background: var(--gradient-warning); }
    .stat-card.info::before { background: var(--gradient-info); }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .stat-icon.primary { background: var(--gradient-primary); }
    .stat-icon.success { background: var(--gradient-success); }
    .stat-icon.warning { background: var(--gradient-warning); }
    .stat-icon.info { background: var(--gradient-info); }

    .stat-number {
      font-size: 2.8rem;
      font-weight: 800;
      color: var(--secondary-color);
      line-height: 1;
      margin-bottom: 8px;
    }

    .stat-label {
      color: #64748b;
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 15px;
    }

    .stat-change {
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
    }

    .stat-change.positive {
      color: var(--success-color);
    }

    .stat-change.negative {
      color: var(--danger-color);
    }

    .chart-container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      margin-bottom: 35px;
      position: relative;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f1f5f9;
    }

    .chart-header h4 {
      margin: 0;
      color: var(--secondary-color);
      font-weight: 600;
      display: flex;
      align-items: center;
    }

    .chart-header i {
      margin-right: 12px;
      color: var(--primary-color);
    }

    #realTimeMap {
      height: 500px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .zone-indicators {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .zone-indicator {
      background: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
    }

    .zone-indicator:hover {
      transform: translateY(-3px);
    }

    .zone-indicator.green {
      border-left: 5px solid var(--success-color);
    }

    .zone-indicator.red {
      border-left: 5px solid var(--danger-color);
    }

    .zone-indicator h5 {
      margin-bottom: 10px;
      font-weight: 600;
    }

    .leaderboard {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      margin-bottom: 35px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 20px;
      margin-bottom: 15px;
      background: #f8fafc;
      border-radius: 15px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .leaderboard-item:hover {
      background: #e2e8f0;
      transform: translateX(5px);
    }

    .leaderboard-item.top {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
      color: #92400e;
    }

    .rank-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 20px;
    }

    .rank-badge.gold { background: #ffd700; color: #92400e; }
    .rank-badge.silver { background: #c0c0c0; color: #374151; }
    .rank-badge.bronze { background: #cd7f32; color: white; }

    .progress-ring {
      width: 60px;
      height: 60px;
      margin-left: auto;
    }

    .btn {
      border-radius: 12px;
      font-weight: 600;
      padding: 12px 25px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.3);
    }

    .btn-primary {
      background: var(--gradient-primary);
    }

    .btn-success {
      background: var(--gradient-success);
    }

    .btn-warning {
      background: var(--gradient-warning);
    }

    .btn-info {
      background: var(--gradient-info);
    }

    .environmental-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 35px;
    }

    .env-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
    }

    .env-card:hover {
      transform: translateY(-5px);
    }

    .env-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .env-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 1.5rem;
      color: white;
    }

    .gauge {
      width: 100%;
      height: 20px;
      background: #e2e8f0;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 15px;
    }

    .gauge-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.6s ease;
      position: relative;
    }

    .gauge-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .modal-content {
      border-radius: 20px;
      border: none;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header {
      border-bottom: 1px solid #e2e8f0;
      border-radius: 20px 20px 0 0;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        left: 0;
        top: 0;
        border-radius: 0;
      }
      
      .content {
        margin-left: 0;
        padding: 15px;
      }
      
      .main-container {
        margin: 5px;
        border-radius: 15px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .stat-number {
        font-size: 2.2rem;
      }
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .report-item {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
    }

    .report-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.15);
    }

    .alert-modern {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .alert-modern::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 4px;
      background: currentColor;
    }

    .top-performers {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      margin-bottom: 35px;
    }

    .performer-item {
      display: flex;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: #f8fafc;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .performer-item:hover {
      background: #e2e8f0;
      transform: translateX(5px);
    }

    .performer-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-right: 15px;
    }

    .progress-bar-modern {
      height: 8px;
      border-radius: 4px;
      background: #e2e8f0;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 4px;
      background: var(--gradient-success);
      transition: width 0.6s ease;
      position: relative;
    }

    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shine 2s infinite;
    }

    .zone-analysis {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      margin-bottom: 35px;
    }

    .zone-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 15px;
      transition: all 0.3s ease;
    }

    .zone-item.excellent {
      background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
      border-left: 4px solid var(--success-color);
    }

    .zone-item.good {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid var(--info-color);
    }

    .zone-item.warning {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid var(--warning-color);
    }

    .zone-item.danger {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left: 4px solid var(--danger-color);
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .metric-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
    }

    .metric-card:hover {
      transform: translateY(-5px);
    }

    .metric-value {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 5px;
    }

    .metric-label {
      color: #64748b;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .trend-indicator {
      display: flex;
      align-items: center;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .trend-up {
      color: var(--success-color);
    }

    .trend-down {
      color: var(--danger-color);
    }

    .real-time-status {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success-color);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
      }
    }
  </style>
</head>

<body>
  <div class="main-container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <h4><i class="bi bi-graph-up-arrow"></i> ECOHELPER</h4>
        <small>Statistika & Monitoring</small>
      </div>
      <div class="sidebar-nav">
        <div class="nav-item">
          <a href="#" class="nav-link active" onclick="showSection('dashboard')">
            <i class="bi bi-speedometer2"></i> Bosh sahifa
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('analytics')">
            <i class="bi bi-bar-chart-line"></i> Tahlil va diagrammalar
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('monitoring')">
            <i class="bi bi-activity"></i> Real vaqt monitoring
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('environmental')">
            <i class="bi bi-globe"></i> Ekologik ko'rsatkichlar
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('leaderboard')">
            <i class="bi bi-trophy"></i> Reyting va faollik
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('zones')">
            <i class="bi bi-geo-alt"></i> Hudud tahlili
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" onclick="showSection('reports')">
            <i class="bi bi-file-earmark-pdf"></i> Hisobotlar
          </a>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <main class="content">
      <!-- Dashboard Section -->
      <div id="dashboard" class="section active">
        <div class="page-header">
          <h2><i class="bi bi-speedometer2"></i> Bosh sahifa</h2>
          <div class="real-time-status" title="Real vaqt rejimi faol"></div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card primary">
            <div class="stat-header">
              <div>
                <div class="stat-number" id="totalReports">1,247</div>
                <div class="stat-label">Jami xabarlar</div>
                <div class="stat-change positive">
                  <i class="bi bi-arrow-up"></i> +12.5% bu oy
                </div>
              </div>
              <div class="stat-icon primary">
                <i class="bi bi-inbox"></i>
              </div>
            </div>
          </div>

          <div class="stat-card success">
            <div class="stat-header">
              <div>
                <div class="stat-number" id="resolvedIssues">983</div>
                <div class="stat-label">Hal qilingan</div>
                <div class="stat-change positive">
                  <i class="bi bi-arrow-up"></i> +18.2% bu oy
                </div>
              </div>
              <div class="stat-icon success">
                <i class="bi bi-check-circle"></i>
              </div>
            </div>
          </div>

          <div class="stat-card info">
            <div class="stat-header">
              <div>
                <div class="stat-number" id="activeUsers">2,834</div>
                <div class="stat-label">Faol foydalanuvchilar</div>
                <div class="stat-change positive">
                  <i class="bi bi-arrow-up"></i> +7.8% bu oy
                </div>
              </div>
              <div class="stat-icon info">
                <i class="bi bi-people"></i>
              </div>
            </div>
          </div>

          <div class="stat-card warning">
            <div class="stat-header">
              <div>
                <div class="stat-number" id="responseTime">2.4</div>
                <div class="stat-label">O'rtacha javob vaqti (soat)</div>
                <div class="stat-change negative">
                  <i class="bi bi-arrow-down"></i> -15.3% bu oy
                </div>
              </div>
              <div class="stat-icon warning">
                <i class="bi bi-clock"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-8">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-graph-up"></i> Haftalik faollik</h4>
                <button class="btn btn-sm btn-primary" onclick="refreshChart('weeklyActivity')">
                  <i class="bi bi-arrow-clockwise"></i> Yangilash
                </button>
              </div>
              <canvas id="weeklyActivityChart" height="300"></canvas>
            </div>
          </div>
          
          <div class="col-lg-4">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-pie-chart"></i> Muammo turlari</h4>
              </div>
              <canvas id="issueTypesChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Analytics Section -->
      <div id="analytics" class="section">
        <div class="page-header">
          <h2><i class="bi bi-bar-chart-line"></i> Tahlil va diagrammalar</h2>
        </div>
        
        <div class="row">
          <div class="col-lg-6">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-geo-alt"></i> Hududlar bo'yicha statistika</h4>
              </div>
              <canvas id="regionChart" height="400"></canvas>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-calendar-month"></i> Oylik o'zgarishlar</h4>
              </div>
              <canvas id="monthlyTrendChart" height="400"></canvas>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h4><i class="bi bi-speedometer"></i> Brigada samaradorligi</h4>
          </div>
          <canvas id="brigadeEfficiencyChart" height="300"></canvas>
        </div>
      </div>

      <!-- Monitoring Section -->
      <div id="monitoring" class="section">
        <div class="page-header">
          <h2><i class="bi bi-activity"></i> Real vaqt monitoring</h2>
        </div>
        
        <div class="zone-indicators">
          <div class="zone-indicator green">
            <h5><i class="bi bi-shield-check"></i> Yashil zona</h5>
            <div class="stat-number text-success">15</div>
            <small>Eng yaxshi xizmat</small>
          </div>
          <div class="zone-indicator red">
            <h5><i class="bi bi-exclamation-triangle"></i> Qizil zona</h5>
            <div class="stat-number text-danger">3</div>
            <small>Diqqat talab etadi</small>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h4><i class="bi bi-geo-alt"></i> Real vaqt xarita</h4>
            <div>
              <button class="btn btn-sm btn-success me-2" onclick="updateMapData()">
                <i class="bi bi-arrow-clockwise"></i> Yangilash
              </button>
              <button class="btn btn-sm btn-info" onclick="toggleHeatmap()">
                <i class="bi bi-thermometer-half"></i> Issiqlik xaritasi
              </button>
            </div>
          </div>
          <div id="realTimeMap"></div>
        </div>
      </div>

      <!-- Environmental Section -->
      <div id="environmental" class="section">
        <div class="page-header">
          <h2><i class="bi bi-globe"></i> Ekologik ko'rsatkichlar</h2>
        </div>
        
        <div class="environmental-grid">
          <div class="env-card">
            <div class="env-header">
              <div class="env-icon" style="background: var(--gradient-warning);">
                <i class="bi bi-cloud"></i>
              </div>
              <div>
                <h5>Issiqxona gazlari</h5>
                <div class="stat-number text-warning">342</div>
                <small>CO2 ppm</small>
              </div>
            </div>
            <div class="gauge">
              <div class="gauge-fill" style="width: 68%; background: var(--gradient-warning);"></div>
            </div>
          </div>

          <div class="env-card">
            <div class="env-header">
              <div class="env-icon" style="background: var(--gradient-info);">
                <i class="bi bi-droplet"></i>
              </div>
              <div>
                <h5>Suv sarfi</h5>
                <div class="stat-number text-info">1,240</div>
                <small>Litr/kun</small>
              </div>
            </div>
            <div class="gauge">
              <div class="gauge-fill" style="width: 45%; background: var(--gradient-info);"></div>
            </div>
          </div>

          <div class="env-card">
            <div class="env-header">
              <div class="env-icon" style="background: var(--gradient-success);">
                <i class="bi bi-recycle"></i>
              </div>
              <div>
                <h5>Chiqindi miqdori</h5>
                <div class="stat-number text-success">89</div>
                <small>Tonna/oy</small>
              </div>
            </div>
            <div class="gauge">
              <div class="gauge-fill" style="width: 75%; background: var(--gradient-success);"></div>
            </div>
          </div>

          <div class="env-card">
            <div class="env-header">
              <div class="env-icon" style="background: var(--gradient-primary);">
                <i class="bi bi-lightning"></i>
              </div>
              <div>
                <h5>Energiya sarfi</h5>
                <div class="stat-number text-primary">567</div>
                <small>kWh/kun</small>
              </div>
            </div>
            <div class="gauge">
              <div class="gauge-fill" style="width: 82%; background: var(--gradient-primary);"></div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h4><i class="bi bi-graph-up"></i> Ekologik tendentsiyalar</h4>
          </div>
          <canvas id="environmentalTrendChart" height="300"></canvas>
        </div>
      </div>

      <!-- Leaderboard Section -->
      <div id="leaderboard" class="section">
        <div class="page-header">
          <h2><i class="bi bi-trophy"></i> Reyting va faollik</h2>
        </div>

        <div class="row">
          <div class="col-lg-6">
            <div class="top-performers">
              <div class="chart-header">
                <h4><i class="bi bi-star-fill"></i> Eng faol foydalanuvchilar</h4>
              </div>
              
              <div class="performer-item">
                <div class="performer-avatar">AM</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">Akmal Mahmudov</h6>
                  <small class="text-muted">124 xabar yuborgan</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 95%"></div>
                  </div>
                </div>
                <div class="rank-badge gold">1</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-success);">DN</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">Dilnoza Normurodova</h6>
                  <small class="text-muted">89 xabar yuborgan</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 72%"></div>
                  </div>
                </div>
                <div class="rank-badge silver">2</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-warning);">SA</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">Sardor Aliyev</h6>
                  <small class="text-muted">76 xabar yuborgan</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 61%"></div>
                  </div>
                </div>
                <div class="rank-badge bronze">3</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-info);">ZK</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">Zilola Karimova</h6>
                  <small class="text-muted">65 xabar yuborgan</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 52%"></div>
                  </div>
                </div>
                <div class="rank-badge">4</div>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="top-performers">
              <div class="chart-header">
                <h4><i class="bi bi-tools"></i> Eng samarali brigadalar</h4>
              </div>
              
              <div class="performer-item">
                <div class="performer-avatar">B1</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">1-Brigada (Chilonzor)</h6>
                  <small class="text-muted">98% hal qilish ko'rsatkichi</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 98%"></div>
                  </div>
                </div>
                <div class="rank-badge gold">1</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-success);">B5</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">5-Brigada (Yunusobod)</h6>
                  <small class="text-muted">94% hal qilish ko'rsatkichi</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 94%"></div>
                  </div>
                </div>
                <div class="rank-badge silver">2</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-warning);">B3</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">3-Brigada (Mirobod)</h6>
                  <small class="text-muted">91% hal qilish ko'rsatkichi</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 91%"></div>
                  </div>
                </div>
                <div class="rank-badge bronze">3</div>
              </div>

              <div class="performer-item">
                <div class="performer-avatar" style="background: var(--gradient-info);">B7</div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">7-Brigada (Yakkasaroy)</h6>
                  <small class="text-muted">88% hal qilish ko'rsatkichi</small>
                  <div class="progress-bar-modern">
                    <div class="progress-bar-fill" style="width: 88%"></div>
                  </div>
                </div>
                <div class="rank-badge">4</div>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h4><i class="bi bi-activity"></i> Haftalik faollik reytingi</h4>
          </div>
          <canvas id="weeklyRankingChart" height="300"></canvas>
        </div>
      </div>

      <!-- Zones Section -->
      <div id="zones" class="section">
        <div class="page-header">
          <h2><i class="bi bi-geo-alt"></i> Hudud tahlili</h2>
        </div>

        <div class="zone-analysis">
          <div class="chart-header">
            <h4><i class="bi bi-map"></i> Hududlar bo'yicha baholash</h4>
          </div>

          <div class="zone-item excellent">
            <div>
              <h5><i class="bi bi-geo-alt-fill me-2"></i>Chilonzor tumani</h5>
              <small>A'lo darajadagi xizmat ko'rsatish</small>
            </div>
            <div class="text-end">
              <div class="metric-value text-success">A+</div>
              <small class="text-success">98.5% samaradorlik</small>
            </div>
          </div>

          <div class="zone-item good">
            <div>
              <h5><i class="bi bi-geo-alt-fill me-2"></i>Yunusobod tumani</h5>
              <small>Yaxshi xizmat ko'rsatish</small>
            </div>
            <div class="text-end">
              <div class="metric-value text-info">A</div>
              <small class="text-info">94.2% samaradorlik</small>
            </div>
          </div>

          <div class="zone-item good">
            <div>
              <h5><i class="bi bi-geo-alt-fill me-2"></i>Mirobod tumani</h5>
              <small>Yaxshi xizmat ko'rsatish</small>
            </div>
            <div class="text-end">
              <div class="metric-value text-info">B+</div>
              <small class="text-info">91.7% samaradorlik</small>
            </div>
          </div>

          <div class="zone-item warning">
            <div>
              <h5><i class="bi bi-geo-alt-fill me-2"></i>Yakkasaroy tumani</h5>
              <small>Yaxshilash talab etiladi</small>
            </div>
            <div class="text-end">
              <div class="metric-value text-warning">B</div>
              <small class="text-warning">85.3% samaradorlik</small>
            </div>
          </div>

          <div class="zone-item danger">
            <div>
              <h5><i class="bi bi-geo-alt-fill me-2"></i>Sergeli tumani</h5>
              <small>Qoniqarsiz xizmat ko'rsatish</small>
            </div>
            <div class="text-end">
              <div class="metric-value text-danger">C</div>
              <small class="text-danger">72.1% samaradorlik</small>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-8">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-bar-chart"></i> Hududlar bo'yicha taqqoslash</h4>
              </div>
              <canvas id="zonesComparisonChart" height="400"></canvas>
            </div>
          </div>
          
          <div class="col-lg-4">
            <div class="environmental-grid">
              <div class="metric-card">
                <div class="metric-value">18</div>
                <div class="metric-label">Jami hududlar</div>
                <div class="trend-indicator trend-up">
                  <i class="bi bi-arrow-up me-1"></i>+2 yangi
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-value">15</div>
                <div class="metric-label">Yashil zonalar</div>
                <div class="trend-indicator trend-up">
                  <i class="bi bi-arrow-up me-1"></i>+3 yaxshilangan
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-value">3</div>
                <div class="metric-label">Qizil zonalar</div>
                <div class="trend-indicator trend-down">
                  <i class="bi bi-arrow-down me-1"></i>-2 kamaygan
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports Section -->
      <div id="reports" class="section">
        <div class="page-header">
          <h2><i class="bi bi-file-earmark-pdf"></i> Hisobotlar</h2>
        </div>

        <div class="row mb-4">
          <div class="col-lg-6">
            <div class="alert-modern alert-info">
              <i class="bi bi-info-circle me-2"></i>
              <strong>Avtomatik hisobotlar:</strong> Har kuni, hafta va oyda avtomatik ravishda hisobotlar yaratiladi va tegishli tashkilotlarga yuboriladi.
            </div>
          </div>
          <div class="col-lg-6">
            <div class="d-flex gap-2">
              <button class="btn btn-primary" onclick="generateReport('daily')">
                <i class="bi bi-calendar-day"></i> Kunlik hisobot
              </button>
              <button class="btn btn-success" onclick="generateReport('weekly')">
                <i class="bi bi-calendar-week"></i> Haftalik hisobot
              </button>
              <button class="btn btn-info" onclick="generateReport('monthly')">
                <i class="bi bi-calendar-month"></i> Oylik hisobot
              </button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-8">
            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-file-text"></i> So'nggi hisobotlar</h4>
              </div>
              
              <div class="report-item">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="stat-icon success me-3">
                      <i class="bi bi-file-earmark-check"></i>
                    </div>
                    <div>
                      <h6 class="mb-1">Oylik hisobot - Noyabr 2024</h6>
                      <small class="text-muted">Yaratilgan: 01.12.2024, 09:30</small>
                    </div>
                  </div>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-eye"></i> Ko'rish
                    </button>
                    <button class="btn btn-sm btn-primary">
                      <i class="bi bi-download"></i> Yuklab olish
                    </button>
                  </div>
                </div>
              </div>

              <div class="report-item">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="stat-icon info me-3">
                      <i class="bi bi-file-earmark-bar-graph"></i>
                    </div>
                    <div>
                      <h6 class="mb-1">Haftalik tahlil - 47-hafta</h6>
                      <small class="text-muted">Yaratilgan: 25.11.2024, 08:00</small>
                    </div>
                  </div>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-eye"></i> Ko'rish
                    </button>
                    <button class="btn btn-sm btn-primary">
                      <i class="bi bi-download"></i> Yuklab olish
                    </button>
                  </div>
                </div>
              </div>

              <div class="report-item">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="stat-icon warning me-3">
                      <i class="bi bi-file-earmark-excel"></i>
                    </div>
                    <div>
                      <h6 class="mb-1">Ekologik ko'rsatkichlar - Q3 2024</h6>
                      <small class="text-muted">Yaratilgan: 15.11.2024, 14:45</small>
                    </div>
                  </div>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-eye"></i> Ko'rish
                    </button>
                    <button class="btn btn-sm btn-primary">
                      <i class="bi bi-download"></i> Yuklab olish
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="environmental-grid">
              <div class="metric-card">
                <div class="metric-value">248</div>
                <div class="metric-label">Jami hisobotlar</div>
                <div class="trend-indicator trend-up">
                  <i class="bi bi-arrow-up me-1"></i>Bu oy +12
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-value">156</div>
                <div class="metric-label">PDF formatida</div>
                <div class="trend-indicator trend-up">
                  <i class="bi bi-file-pdf me-1"></i>63%
                </div>
              </div>
              
              <div class="metric-card">
                <div class="metric-value">92</div>
                <div class="metric-label">Excel formatida</div>
                <div class="trend-indicator trend-up">
                  <i class="bi bi-file-excel me-1"></i>37%
                </div>
              </div>
            </div>

            <div class="chart-container">
              <div class="chart-header">
                <h4><i class="bi bi-pie-chart"></i> Hisobot turlari</h4>
              </div>
              <canvas id="reportTypesChart" height="250"></canvas>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Global variables
    let map;
    let charts = {};
    let isHeatmapActive = false;

    // Navigation
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from nav links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Add active class to clicked nav link
      event.target.classList.add('active');
      
      // Initialize charts for the active section
      setTimeout(() => {
        initChartsForSection(sectionId);
      }, 100);
    }

    // Initialize charts for specific section
    function initChartsForSection(sectionId) {
      switch(sectionId) {
        case 'dashboard':
          initWeeklyActivityChart();
          initIssueTypesChart();
          break;
        case 'analytics':
          initRegionChart();
          initMonthlyTrendChart();
          initBrigadeEfficiencyChart();
          break;
        case 'monitoring':
          initRealTimeMap();
          break;
        case 'environmental':
          initEnvironmentalTrendChart();
          break;
        case 'leaderboard':
          initWeeklyRankingChart();
          break;
        case 'zones':
          initZonesComparisonChart();
          break;
        case 'reports':
          initReportTypesChart();
          break;
      }
    }

    // Chart initialization functions
    function initWeeklyActivityChart() {
      if (charts.weeklyActivity) {
        charts.weeklyActivity.destroy();
      }
      
      const ctx = document.getElementById('weeklyActivityChart').getContext('2d');
      charts.weeklyActivity = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Dushanba', 'Seshanba', 'Chorshanba', 'Payshanba', 'Juma', 'Shanba', 'Yakshanba'],
          datasets: [{
            label: 'Xabarlar',
            data: [45, 52, 38, 65, 78, 42, 28],
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#667eea',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6
          }, {
            label: 'Hal qilingan',
            data: [42, 48, 35, 58, 68, 38, 25],
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#10b981',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                  weight: '600'
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0,0,0,0.05)'
              },
              ticks: {
                font: {
                  weight: '500'
                }
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: {
                  weight: '500'
                }
              }
            }
          },
          elements: {
            point: {
              hoverRadius: 8
            }
          }
        }
      });
    }

    function initIssueTypesChart() {
      if (charts.issueTypes) {
        charts.issueTypes.destroy();
      }
      
      const ctx = document.getElementById('issueTypesChart').getContext('2d');
      charts.issueTypes = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Chiqindi', 'Havodagi ifloslanish', 'Shovqin', 'Suv ifloslanishi', 'Boshqalar'],
          datasets: [{
            data: [45, 25, 15, 10, 5],
            backgroundColor: [
              '#667eea',
              '#10b981',
              '#f59e0b',
              '#06b6d4',
              '#ef4444'
            ],
            borderWidth: 0,
            hoverBorderWidth: 3,
            hoverBorderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 15,
                font: {
                  weight: '500'
                }
              }
            }
          },
          cutout: '65%'
        }
      });
    }

    function initRegionChart() {
      if (charts.region) {
        charts.region.destroy();
      }
      
      const ctx = document.getElementById('regionChart').getContext('2d');
charts.region = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Chilonzor', 'Yunusobod', 'Mirobod', 'Yakkasaroy', 'Sergeli'],
        datasets: [{
            label: 'Xabarlar soni',
            data: [245, 189, 167, 143, 98],
            backgroundColor: [
                'rgba(102, 126, 234, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(6, 182, 212, 0.8)',
                'rgba(239, 68, 68, 0.8)'
            ],
            borderColor: [
                'rgba(102, 126, 234, 1)',
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)',
                'rgba(6, 182, 212, 1)',
                'rgba(239, 68, 68, 1)'
            ],
            borderWidth: 1,
            borderRadius: 8
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                backgroundColor: '#1e293b',
                titleFont: {
                    weight: 'bold',
                    size: 14
                },
                bodyFont: {
                    size: 12
                },
                padding: 12,
                cornerRadius: 12,
                displayColors: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0,0,0,0.05)'
                },
                ticks: {
                    font: {
                        weight: '500'
                    }
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    font: {
                        weight: '500'
                    }
                }
            }
        }
    }
});}

function initMonthlyTrendChart() {
    if (charts.monthlyTrend) {
        charts.monthlyTrend.destroy();
    }
    
    const ctx = document.getElementById('monthlyTrendChart').getContext('2d');
    charts.monthlyTrend = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Yanvar', 'Fevral', 'Mart', 'Aprel', 'May', 'Iyun', 'Iyul', 'Avgust', 'Sentabr', 'Oktabr', 'Noyabr', 'Dekabr'],
            datasets: [{
                label: 'Xabarlar',
                data: [125, 143, 178, 156, 198, 234, 287, 265, 243, 278, 312, 298],
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.3
            }, {
                label: 'Hal qilingan',
                data: [118, 135, 165, 148, 185, 218, 265, 250, 230, 260, 295, 285],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            weight: '600'
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    },
                    ticks: {
                        font: {
                            weight: '500'
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            weight: '500'
                        }
                    }
                }
            }
        }
    });
}

function initBrigadeEfficiencyChart() {
    if (charts.brigadeEfficiency) {
        charts.brigadeEfficiency.destroy();
    }
    
    const ctx = document.getElementById('brigadeEfficiencyChart').getContext('2d');
    charts.brigadeEfficiency = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Tezlik', 'Sifat', 'Xabarlarga javob', 'Aholi qoniqishi', 'Tozalik darajasi'],
            datasets: [
                {
                    label: '1-Brigada',
                    data: [95, 98, 97, 96, 99],
                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                    borderColor: '#667eea',
                    borderWidth: 2,
                    pointBackgroundColor: '#667eea',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 6
                },
                {
                    label: '2-Brigada',
                    data: [88, 92, 90, 89, 93],
                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                    borderColor: '#10b981',
                    borderWidth: 2,
                    pointBackgroundColor: '#10b981',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            weight: '600'
                        }
                    }
                }
            },
            scales: {
                r: {
                    angleLines: {
                        color: 'rgba(0,0,0,0.1)'
                    },
                    suggestedMin: 50,
                    suggestedMax: 100,
                    ticks: {
                        font: {
                            weight: '500'
                        }
                    }
                }
            }
        }
    });
}

function initRealTimeMap() {
    if (map) {
        map.remove();
    }
    
    // Initialize map centered on Tashkent
    map = L.map('realTimeMap').setView([41.2995, 69.2401], 12);
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
    // Add sample markers for different districts
    const districts = [
        {name: "Chilonzor", coords: [41.2894, 69.2036], reports: 45, status: "green"},
        {name: "Yunusobod", coords: [41.3417, 69.2847], reports: 32, status: "green"},
        {name: "Mirobod", coords: [41.3106, 69.2806], reports: 28, status: "yellow"},
        {name: "Yakkasaroy", coords: [41.2825, 69.2664], reports: 38, status: "yellow"},
        {name: "Sergeli", coords: [41.2075, 69.2325], reports: 52, status: "red"}
    ];
    
    districts.forEach(district => {
        let iconColor;
        if (district.status === "green") iconColor = "#10b981";
        else if (district.status === "yellow") iconColor = "#f59e0b";
        else iconColor = "#ef4444";
        
        const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background: ${iconColor}; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.2);">${district.reports}</div>`,
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });
        
        const marker = L.marker(district.coords, {icon: icon}).addTo(map);
        marker.bindPopup(`<b>${district.name}</b><br>Xabarlar soni: ${district.reports}<br>Status: ${district.status === "green" ? "Yaxshi" : district.status === "yellow" ? "O'rtacha" : "Yomon"}`);
    });
}

function toggleHeatmap() {
    isHeatmapActive = !isHeatmapActive;
    const btn = document.querySelector('[onclick="toggleHeatmap()"]');
    
    if (isHeatmapActive) {
        btn.innerHTML = '<i class="bi bi-map"></i> Oddiy xarita';
        // Here you would add heatmap layer (requires heatmap.js or similar)
        alert("Issiqlik xaritasi aktiv qilindi (demo rejimda)");
    } else {
        btn.innerHTML = '<i class="bi bi-thermometer-half"></i> Issiqlik xaritasi';
        // Remove heatmap layer
        alert("Oddiy xarita rejimiga o'tildi");
    }
}

function updateMapData() {
    alert("Xarita ma'lumotlari yangilandi (demo rejimda)");
    // In a real app, you would fetch new data and update markers
}

// Initialize all charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    initChartsForSection('dashboard');
});

function initEnvironmentalTrendChart() {
    if (charts.environmentalTrend) {
        charts.environmentalTrend.destroy();
    }
    
    const ctx = document.getElementById('environmentalTrendChart').getContext('2d');
    charts.environmentalTrend = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Yan', 'Fev', 'Mar', 'Apr', 'May', 'Iyun', 'Iyul', 'Avg', 'Sen', 'Okt', 'Noy', 'Dek'],
            datasets: [
                {
                    label: 'CO2 (ppm)',
                    data: [320, 325, 330, 335, 340, 345, 342, 338, 335, 332, 330, 328],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    yAxisID: 'y'
                },
                {
                    label: 'Suv sarfi (kL)',
                    data: [1200, 1250, 1300, 1350, 1400, 1450, 1500, 1450, 1400, 1350, 1300, 1250],
                    borderColor: '#06b6d4',
                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            weight: '600'
                        }
                    }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'CO2 (ppm)'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Suv sarfi (kL)'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
}

function initWeeklyRankingChart() {
    if (charts.weeklyRanking) {
        charts.weeklyRanking.destroy();
    }
    
    const ctx = document.getElementById('weeklyRankingChart').getContext('2d');
    charts.weeklyRanking = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['1-hafta', '2-hafta', '3-hafta', '4-hafta'],
            datasets: [
                {
                    label: '1-Brigada',
                    data: [95, 92, 96, 98],
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderRadius: 8
                },
                {
                    label: '2-Brigada',
                    data: [88, 85, 90, 92],
                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                    borderRadius: 8
                },
                {
                    label: '3-Brigada',
                    data: [82, 80, 85, 88],
                    backgroundColor: 'rgba(245, 158, 11, 0.8)',
                    borderRadius: 8
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            weight: '600'
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    min: 70,
                    max: 100,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    },
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
}

function initZonesComparisonChart() {
    if (charts.zonesComparison) {
        charts.zonesComparison.destroy();
    }
    
    const ctx = document.getElementById('zonesComparisonChart').getContext('2d');
    charts.zonesComparison = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Chilonzor', 'Yunusobod', 'Mirobod', 'Yakkasaroy', 'Sergeli'],
            datasets: [
                {
                    label: 'Xabarlar',
                    data: [245, 189, 167, 143, 98],
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderRadius: 8
                },
                {
                    label: 'Hal qilingan',
                    data: [240, 182, 158, 130, 70],
                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                    borderRadius: 8
                },
                {
                    label: 'Qoniqish darajasi',
                    data: [98, 94, 91, 85, 72],
                    backgroundColor: 'rgba(245, 158, 11, 0.8)',
                    borderRadius: 8
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            weight: '600'
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
}

function initReportTypesChart() {
    if (charts.reportTypes) {
        charts.reportTypes.destroy();
    }
    
    const ctx = document.getElementById('reportTypesChart').getContext('2d');
    charts.reportTypes = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Kunlik', 'Haftalik', 'Oylik', 'Yillik', 'Maxsus'],
            datasets: [{
                data: [35, 25, 20, 10, 10],
                backgroundColor: [
                    '#667eea',
                    '#10b981',
                    '#f59e0b',
                    '#06b6d4',
                    '#ef4444'
                ],
                borderWidth: 0,
                hoverBorderWidth: 3,
                hoverBorderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        usePointStyle: true,
                        padding: 15,
                        font: {
                            weight: '500'
                        }
                    }
                }
            }
        }
    });
}

function refreshChart(chartId) {
    switch(chartId) {
        case 'weeklyActivity':
            initWeeklyActivityChart();
            break;
        // Add other charts as needed
    }
    alert('Diagramma yangilandi!');
}

function generateReport(type) {
    let reportName = '';
    switch(type) {
        case 'daily':
            reportName = 'Kunlik hisobot';
            break;
        case 'weekly':
            reportName = 'Haftalik hisobot';
            break;
        case 'monthly':
            reportName = 'Oylik hisobot';
            break;
    }
    
    // Show loading state
    const btn = event.target;
    const originalHtml = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Yaratilmoqda...';
    btn.disabled = true;
    
    // Simulate report generation
    setTimeout(() => {
        btn.innerHTML = originalHtml;
        btn.disabled = false;
        alert(`${reportName} muvaffaqiyatli yaratildi va yuklab olindi!`);
    }, 2000);
}

// Add custom marker styles
const style = document.createElement('style');
style.innerHTML = `
    .custom-marker {
        background: transparent;
        border: none;
    }
    .custom-marker div {
        display: flex;
        justify-content: center;
        align-items: center;
    }
`;
document.head.appendChild(style);

// Initialize all charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    initChartsForSection('dashboard');
});

// Real vaqt statistik ma'lumotlarini yangilash
function updateRealTimeStats() {
    // Bu funksiya real vaqtda statistik ma'lumotlarni yangilash uchun ishlatiladi
    // API orqali ma'lumotlarni olish va yangilash
    fetch('/api/real-time-stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalReports').textContent = data.totalReports.toLocaleString();
            document.getElementById('resolvedIssues').textContent = data.resolvedIssues.toLocaleString();
            document.getElementById('activeUsers').textContent = data.activeUsers.toLocaleString();
            document.getElementById('responseTime').textContent = data.responseTime.toFixed(1);
            
            // Statistik ko'rsatkichlardagi o'zgarishlarni yangilash
            document.querySelectorAll('.stat-change.positive').forEach(el => {
                el.innerHTML = `<i class="bi bi-arrow-up"></i> +${(Math.random() * 15 + 5).toFixed(1)}% bu oy`;
            });
            document.querySelectorAll('.stat-change.negative').forEach(el => {
                el.innerHTML = `<i class="bi bi-arrow-down"></i> -${(Math.random() * 10 + 5).toFixed(1)}% bu oy`;
            });
        })
        .catch(error => {
            console.error('Real vaqt ma\'lumotlarini olishda xato:', error);
        });
}

// Hududlardagi muammolarni real vaqtda yangilash
function updateDistrictIssues() {
    const districts = ['Chilonzor', 'Yunusobod', 'Mirobod', 'Yakkasaroy', 'Sergeli'];
    const randomData = districts.map(() => Math.floor(Math.random() * 100) + 50);
    
    if (charts.region) {
        charts.region.data.datasets[0].data = randomData;
        charts.region.update();
    }
}

// PDF hisobot yaratish funksiyasi (simulyatsiya)
function generatePDFReport(reportType) {
    return new Promise((resolve) => {
        // Simulyatsiya - haqiqiy loyihada bu PDF generatsiya kutubxonasi bo'ladi
        setTimeout(() => {
            const reports = {
                daily: { name: "Kunlik hisobot", size: "1.2 MB" },
                weekly: { name: "Haftalik hisobot", size: "3.5 MB" },
                monthly: { name: "Oylik hisobot", size: "5.8 MB" }
            };
            resolve(reports[reportType]);
        }, 1500);
    });
}

// Faylni yuklab olish funksiyasi
function downloadFile(filename, content) {
    const element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
}

// Xaritada markerlarni yangilash
function updateMapMarkers() {
    if (!map) return;
    
    // Eski markerlarni o'chirish
    map.eachLayer(layer => {
        if (layer instanceof L.Marker) {
            map.removeLayer(layer);
        }
    });
    
    // Yangi markerlarni qo'shish
    const districts = [
        {name: "Chilonzor", coords: [41.2894, 69.2036], reports: Math.floor(Math.random() * 50) + 20, status: "green"},
        {name: "Yunusobod", coords: [41.3417, 69.2847], reports: Math.floor(Math.random() * 40) + 15, status: "green"},
        {name: "Mirobod", coords: [41.3106, 69.2806], reports: Math.floor(Math.random() * 60) + 10, status: "yellow"},
        {name: "Yakkasaroy", coords: [41.2825, 69.2664], reports: Math.floor(Math.random() * 70) + 20, status: "yellow"},
        {name: "Sergeli", coords: [41.2075, 69.2325], reports: Math.floor(Math.random() * 80) + 30, status: "red"}
    ];
    
    districts.forEach(district => {
        let iconColor;
        if (district.status === "green") iconColor = "#10b981";
        else if (district.status === "yellow") iconColor = "#f59e0b";
        else iconColor = "#ef4444";
        
        const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background: ${iconColor}; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.2);">${district.reports}</div>`,
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });
        
        const marker = L.marker(district.coords, {icon: icon}).addTo(map);
        marker.bindPopup(`<b>${district.name}</b><br>Xabarlar soni: ${district.reports}<br>Status: ${district.status === "green" ? "Yaxshi" : district.status === "yellow" ? "O'rtacha" : "Yomon"}`);
    });
}

// Real vaqt yangilash intervalid
let realTimeInterval;

// Real vaqt rejimini boshlash/to'xtatish
function toggleRealTimeUpdates() {
    const toggleBtn = document.getElementById('realTimeToggle');
    
    if (realTimeInterval) {
        clearInterval(realTimeInterval);
        realTimeInterval = null;
        toggleBtn.innerHTML = '<i class="bi bi-play-circle"></i> Real vaqt rejimini yoqish';
        toggleBtn.classList.remove('btn-danger');
        toggleBtn.classList.add('btn-success');
    } else {
        realTimeInterval = setInterval(() => {
            updateRealTimeStats();
            updateDistrictIssues();
            updateMapMarkers();
        }, 5000); // Har 5 sekundda yangilash
        
        toggleBtn.innerHTML = '<i class="bi bi-pause-circle"></i> Real vaqt rejimini o\'chirish';
        toggleBtn.classList.remove('btn-success');
        toggleBtn.classList.add('btn-danger');
    }
}

// Sahifada barcha interaktiv elementlarni ishga tushirish
function initializeInteractiveElements() {
    // Hisobot yaratish tugmalari
    document.querySelectorAll('[onclick^="generateReport"]').forEach(btn => {
        btn.addEventListener('click', function() {
            const reportType = this.getAttribute('onclick').replace('generateReport(\'', '').replace('\')', '');
            generateReport(reportType);
        });
    });
    
    // Xaritani yangilash tugmasi
    document.querySelector('[onclick="updateMapData()"]').addEventListener('click', updateMapMarkers);
    
    // Real vaqt rejimi tugmasi
    const realTimeToggleBtn = document.createElement('button');
    realTimeToggleBtn.id = 'realTimeToggle';
    realTimeToggleBtn.className = 'btn btn-success btn-sm';
    realTimeToggleBtn.innerHTML = '<i class="bi bi-play-circle"></i> Real vaqt rejimini yoqish';
    realTimeToggleBtn.onclick = toggleRealTimeUpdates;
    
    const monitoringHeader = document.querySelector('#monitoring .chart-header');
    if (monitoringHeader) {
        monitoringHeader.appendChild(realTimeToggleBtn);
    }
}

// DOM yuklanganidan so'ng barcha funksiyalarni ishga tushirish
document.addEventListener('DOMContentLoaded', function() {
    initChartsForSection('dashboard');
    initializeInteractiveElements();
    
    // Dastlabki statistik ma'lumotlarni yangilash
    updateRealTimeStats();
    
    // Mobile menyuni boshqarish
    const mobileMenuToggle = document.createElement('button');
    mobileMenuToggle.className = 'btn btn-primary d-lg-none mobile-menu-toggle';
    mobileMenuToggle.innerHTML = '<i class="bi bi-list"></i> Menyu';
    mobileMenuToggle.onclick = function() {
        document.querySelector('.sidebar').classList.toggle('mobile-visible');
    };
    
    document.querySelector('.content').prepend(mobileMenuToggle);
    
    // Mobil versiya uchun CSS qo'shish
    const mobileStyle = document.createElement('style');
    mobileStyle.innerHTML = `
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1050;
            }
            .sidebar.mobile-visible {
                transform: translateX(0);
            }
            .mobile-menu-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1051;
            }
            .content {
                margin-left: 0 !important;
            }
        }
    `;
    document.head.appendChild(mobileStyle);
});

// Brauzer oynasi o'lchami o'zgarganda sidebar va contentni moslashtirish
window.addEventListener('resize', function() {
    const sidebar = document.querySelector('.sidebar');
    const content = document.querySelector('.content');
    
    if (window.innerWidth > 992) {
        sidebar.style.transform = 'none';
        content.style.marginLeft = 'var(--sidebar-width)';
    } else {
        content.style.marginLeft = '0';
    }
});

// Saytni ishlatish bo'yicha qo'llanma (tutorial)
function showTutorial() {
    const tutorialSteps = [
        {
            element: '#dashboard',
            content: 'Bu bosh sahifa hisoblanadi. Bu yerda asosiy statistik ma\'lumotlar va diagrammalar ko\'rsatiladi.',
            position: 'right'
        },
        {
            element: '#analytics',
            content: 'Analitika bo\'limida hududlar va vaqt oralig\'i bo\'yicha tahlillarni ko\'rishingiz mumkin.',
            position: 'right'
        },
        {
            element: '#monitoring',
            content: 'Real vaqt monitoringida hududlardagi muammolarni xaritada ko\'rishingiz mumkin.',
            position: 'left'
        },
        {
            element: '#reports',
            content: 'Hisobotlar bo\'limida turli formatdagi hisobotlarni yaratishingiz va yuklab olishingiz mumkin.',
            position: 'left'
        }
    ];
    
    // Tutorial kutubxonasini ishga tushirish (agar mavjud bo'lsa)
    if (typeof introJs !== 'undefined') {
        introJs().setOptions({
            steps: tutorialSteps,
            nextLabel: 'Keyingi',
            prevLabel: 'Oldingi',
            doneLabel: 'Tayyor',
            skipLabel: 'O\'tkazib yuborish'
        }).start();
    } else {
        // Agar intro.js kutubxonasi yo'q bo'lsa, oddiy alert orqali ko'rsatish
        alert('ECOHELPER tizimiga xush kelibsiz!\n\nTizim orqali ekologik muammolar monitoringi va statistikasini ko\'rishingiz mumkin.');
    }
}

// Dastur ishga tushganda tutorialni ko'rsatish
setTimeout(showTutorial, 1000);
</script>

 <!-- Qo'shimcha JavaScript kutubxonalari -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js-plugin-datalabels@2.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

  <script>
    // Real vaqt statistik ma'lumotlarini yangilash
    function updateRealTimeStats() {
      // Simulyatsiya - haqiqiy loyihada API so'rov bo'ladi
      setTimeout(() => {
        document.getElementById('totalReports').textContent = (Math.random() * 500 + 1000).toFixed(0);
        document.getElementById('resolvedIssues').textContent = (Math.random() * 400 + 800).toFixed(0);
        document.getElementById('activeUsers').textContent = (Math.random() * 1000 + 2000).toFixed(0);
        document.getElementById('responseTime').textContent = (Math.random() * 1.5 + 1.5).toFixed(1);
      }, 800);
    }

    // Faylni yuklab olish funksiyasi
    function downloadReport() {
      const btn = event.target;
      const originalText = btn.innerHTML;
      
      btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Yuklanmoqda...';
      btn.disabled = true;
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert('Hisobot muvaffaqiyatli yuklab olindi!');
      }, 1500);
    }

    // Xaritani tozalash
    function clearMap() {
      if (map) {
        map.eachLayer(layer => {
          if (layer instanceof L.Marker) {
            map.removeLayer(layer);
          }
        });
      }
    }

    // Brauzer yopilishida intervallarni tozalash
    window.addEventListener('beforeunload', function() {
      if (realTimeInterval) {
        clearInterval(realTimeInterval);
      }
    });

    // Saytga kirishda avvalgi tanlangan bo'limni saqlash
    document.addEventListener('DOMContentLoaded', function() {
      const lastActiveSection = localStorage.getItem('lastActiveSection') || 'dashboard';
      showSection(lastActiveSection);
      
      // Har bir bo'limga o'tganda saqlash
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function() {
          const sectionId = this.getAttribute('onclick').replace("showSection('", "").replace("')", "");
          localStorage.setItem('lastActiveSection', sectionId);
        });
      });
    });

    // Dark/Light mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // Dark mode ni tekshirish
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    // Tizim versiyasi va yangilanishlar
    const systemVersion = "1.0.0";
    console.log(`ECOHELPER Monitoring Tizimi v${systemVersion}`);

    

    // Offline holatni aniqlash
    window.addEventListener('offline', function() {
      alert('Internet aloqasi uzildi! Tizim faqat offline rejimda ishlaydi.');
    });

    window.addEventListener('online', function() {
      alert('Internet aloqasi tiklandi! Tizim normal rejimda ishlayapti.');
      if (realTimeInterval) {
        updateRealTimeStats();
      }
    });

    // PWA uchun service worker ro'yxatdan o'tkazish
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
          console.log('ServiceWorker registratsiya muvaffaqiyatli: ', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registratsiya muvaffaqiyatsiz: ', err);
        });
      });
    }

    // Sayt yangilanishlarini tekshirish
    function checkForUpdates() {
      fetch('/version.json')
        .then(response => response.json())
        .then(data => {
          if (data.version !== systemVersion) {
            if (confirm('Yangi yangilanish mavjud! Hozir yangilashni xohlaysizmi?')) {
              window.location.reload(true);
            }
          }
        })
        .catch(error => console.log('Versiyani tekshirishda xato:', error));
    }

    // Har 1 soatda yangilanishlarni tekshirish
    setInterval(checkForUpdates, 3600000);

  </script>

  <!-- Footer qismi -->
  <footer class="text-center py-3" style="background-color: var(--secondary-color); color: white;">
    <div class="container">
      <p class="mb-0">© 2024 ECOHELPER Monitoring Tizimi | Barcha huquqlar himoyalangan</p>
      <p class="mb-0 small">Ishlab chiquvchilar: ECOHELPER Dasturchilar Jamoasi</p>
      <p class="small">Versiya: 1.0.0 | Yangilanish sanasi: 15.12.2024</p>
    </div>
  </footer>

</body>
</html>
